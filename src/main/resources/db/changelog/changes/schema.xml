<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd">

    <changeSet id="create_schema" author="SemyonKorostik">
        <createTable tableName="user_role">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="role_name" type="varchar(40)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="user">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="user_login" type="varchar(150)">
                <constraints nullable="false"/>
            </column>
            <column name="user_password" type="clob">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="language" type="varchar(30)"/>
        </createTable>

        <createTable tableName="test">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="int"/>
            <column name="created_at" type="datetime"/>
            <column name="updated_at" type="datetime"/>
            <column name="started_at" type="datetime"/>
            <column name="finished_at" type="datetime"/>
            <column name="status" type="varchar(256)"/>
            <column name="evaluation" type="int" defaultValue="0"/>
        </createTable>

        <createTable tableName="level">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="level_name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="module">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="module_name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="question">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="question_body" type="clob"/>
            <column name="points" type="int"/>
            <column name="level_id" type="int">
            </column>
            <column name="module_id" type="int">
            </column>
            <column name="creator_user_id" type="int"/>
            <column name="is_avaliable" type="boolean" defaultValue="true"/>
        </createTable>

        <createTable tableName="test_question">
            <column name="test_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="answer">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="answer_body" type="clob"/>
            <column name="question_id" type="int"/>
            <column name="is_correct" type="boolean" defaultValue="false"/>
        </createTable>

        <createTable tableName="file_answer">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="url" type="clob">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="content_file">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="question_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="url" type="clob">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="choosen_option">
            <column name="test_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="choosen_answer_id" type="int"/>
            <column name="file_answer_id" type="int"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="user" baseColumnNames="role_id"
                                 constraintName="user_user_role_fk"
                                 referencedTableName="user_role" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="test" baseColumnNames="user_id" constraintName="test_user_fk"
                                 referencedTableName="user" referencedColumnNames="id"/>


        <addForeignKeyConstraint baseTableName="question" baseColumnNames="level_id"
                                 constraintName="question_level_fk"
                                 referencedTableName="level" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="question" baseColumnNames="module_id"
                                 constraintName="question_module_fk"
                                 referencedTableName="module" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="question" baseColumnNames="creator_user_id"
                                 constraintName="question_user_fk"
                                 referencedTableName="user" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="test_question" baseColumnNames="test_id"
                                 constraintName="test_question_test_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="test_question" baseColumnNames="question_id"
                                 constraintName="test_question_question_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="answer" baseColumnNames="question_id"
                                 constraintName="answer_question_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="content_file" baseColumnNames="question_id"
                                 constraintName="content_file_question_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="choosen_option" baseColumnNames="test_id"
                                 constraintName="choosen_option_test_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="choosen_option" baseColumnNames="question_id"
                                 constraintName="choosen_option_question_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="choosen_option" baseColumnNames="choosen_answer_id"
                                 constraintName="choosen_option_answer_fk"
                                 referencedTableName="answer" referencedColumnNames="id"/>


    </changeSet>

    <changeSet id="update_status_type" author="Anlord241">
        <validCheckSum>8:429e8ab296a5ea20f0e1bb7bf7a5f389</validCheckSum>
        <sql>CREATE TYPE status AS ENUM ('NOT_STARTED', 'STARTED', 'FINISHED')</sql>
        <modifyDataType
                columnName="status"
                newDataType="status"
                schemaName="language_testing"
                tableName="test"/>
    </changeSet>

    <changeSet id="delete_column" author="Darina">
        <dropColumn tableName="question"
                    columnName="points"/>
    </changeSet>

    <changeSet id="update_column_name" author="Darina">
        <renameColumn tableName="question"
                      oldColumnName="is_avaliable"
                      newColumnName="is_available"
                      columnDataType="boolean"/>
    </changeSet>

    <changeSet id="add_table_coach_grades" author="Darina">
        <createTable tableName="coach_grade">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="grade" type="int" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="question_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="test_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="coach_grade"
                                 baseColumnNames="question_id"
                                 constraintName="question_id_fk"
                                 referencedTableName="question"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="coach_grade"
                                 baseColumnNames="test_id"
                                 constraintName="test_id_fk"
                                 referencedTableName="test"
                                 referencedColumnNames="id"/>

    </changeSet>

    <changeSet id="add_field_coach_to_test" author="Darina">
        <addColumn tableName="test">
            <column name="coach_id" type="int"/>
        </addColumn>

        <addForeignKeyConstraint baseTableName="test"
                                 baseColumnNames="coach_id"
                                 constraintName="coach_id_fk"
                                 referencedTableName="user"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_fk_for_file_answer" author="Darina">
        <addForeignKeyConstraint baseTableName="file_answer"
                                 baseColumnNames="question_id"
                                 constraintName="file_answer_question_id_fk"
                                 referencedTableName="question"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_fk_for_choosen_option" author="Darina">
        <addForeignKeyConstraint baseTableName="choosen_option"
                                 baseColumnNames="file_answer_id"
                                 constraintName="choosen_option_file_answer_fk"
                                 referencedTableName="file_answer"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_users" author="maxim12321">
        <insert tableName="user_role">
            <column name="id" valueSequenceNext="user_role_id_seq"/>
            <column name="role_name" value="ROLE_USER"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="rus_user@northsixty.com"/>
            <column name="user_name" value="Russian User"/>
            <column name="user_password" value="$2a$08$GMxUHVbQLa8OAz3OPDWSueJCMhWlcpPnUMusgBXMkHMoJQ.SP.FYq"/>
            <column name="language" value="rus"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="eng_user@northsixty.com"/>
            <column name="user_name" value="English User"/>
            <column name="user_password" value="$2a$08$a0aliBqS39BxT4yrca6hHOh2ci6e5k3A/98myrElGBM8jwwkf.l0q"/>
            <column name="language" value="eng"/>
        </insert>

        <insert tableName="user_role">
            <column name="id" valueSequenceNext="user_role_id_seq"/>
            <column name="role_name" value="ROLE_HR"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="rus_hr@northsixty.com"/>
            <column name="user_name" value="Russian HR"/>
            <column name="user_password" value="$2a$08$gEE.rXie709tNz5VrcpkTOjCHk3A8ZcAjI7M5Y04ytoCq3fx/t2ze"/>
            <column name="language" value="rus"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="eng_hr@northsixty.com"/>
            <column name="user_name" value="English HR"/>
            <column name="user_password" value="$2a$08$X5.33q5PiFEcfO2uheVd4ucBCTplC7JIylm2nMkmrjJYrE5fQeRDW"/>
            <column name="language" value="eng"/>
        </insert>

        <insert tableName="user_role">
            <column name="id" valueSequenceNext="user_role_id_seq"/>
            <column name="role_name" value="ROLE_COACH"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="rus_coach@northsixty.com"/>
            <column name="user_name" value="Russian Coach"/>
            <column name="user_password" value="$2a$08$9Ct.DBw2OvPu9R9EOTzJnuIa3XfIhnDN6ZamvgYjuJhbi4gQTRpY2"/>
            <column name="language" value="rus"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="eng_coach@northsixty.com"/>
            <column name="user_name" value="English Coach"/>
            <column name="user_password" value="$2a$08$PHQ4VV9rcvsMlSlmnQjVWu11.qvUJC0WIRE/coSisCAc6rO316.wq"/>
            <column name="language" value="eng"/>
        </insert>

        <insert tableName="user_role">
            <column name="id" valueSequenceNext="user_role_id_seq"/>
            <column name="role_name" value="ROLE_ADMIN"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="rus_admin@northsixty.com"/>
            <column name="user_name" value="Russian Admin"/>
            <column name="user_password" value="$2a$08$sp14HY.XnK2w.qRE7fqMA.ja2aSL5sFGMSPSPdk/nHK.2Lj4GgK.q"/>
            <column name="language" value="rus"/>
        </insert>
        <insert tableName="user">
            <column name="id" valueSequenceNext="user_id_seq"/>
            <column name="role_id" valueSequenceCurrent="user_role_id_seq"/>
            <column name="user_login" value="eng_admin@northsixty.com"/>
            <column name="user_name" value="English Admin"/>
            <column name="user_password" value="$2a$08$PZwaUFgnbTJ9yihBjkDd0e5pWCZfbWohfB/823LjCRE.sUnP2KuJm"/>
            <column name="language" value="eng"/>
        </insert>

        <rollback>
            <delete tableName="user_role">
                <where>role_name in ("ROLE_USER", "ROLE_HR", "ROLE_COACH", "ROLE_ADMIN")</where>
            </delete>
            <delete tableName="user">
                <where>user_login in ("rus_user", "rus_hr", "rus_coach", "rus_admin")</where>
            </delete>
            <delete tableName="user">
                <where>user_login in ("eng_user", "eng_hr", "eng_coach", "eng_admin")</where>
            </delete>
        </rollback>
    </changeSet>

    <changeSet id="add_modules" author="Darina">
        <insert tableName="module">
            <column name="module_name">Grammar</column>
        </insert>
        <insert tableName="module">
            <column name="module_name">Listening</column>
        </insert>
        <insert tableName="module">
            <column name="module_name">Essay</column>
        </insert>
        <insert tableName="module">
            <column name="module_name">Speaking</column>
        </insert>
    </changeSet>

    <changeSet id="add_level" author="Darina">
        <insert tableName="level">
            <column name="level_name">A1</column>
        </insert>
        <insert tableName="level">
            <column name="level_name">A2</column>
        </insert>
        <insert tableName="level">
            <column name="level_name">B1</column>
        </insert>
        <insert tableName="level">
            <column name="level_name">B2</column>
        </insert>
        <insert tableName="level">
            <column name="level_name">C1</column>
        </insert>
        <insert tableName="level">
            <column name="level_name">C2</column>
        </insert>

    </changeSet>

    <changeSet id="add_level_test" author="Darina">
        <addColumn tableName="test">
            <column name="level_id" type="int"/>
        </addColumn>
        <addForeignKeyConstraint baseTableName="test"
                                 baseColumnNames="level_id"
                                 constraintName="test_level_id_fk"
                                 referencedTableName="level"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="delete_question_id_from_content_file" author="Darina">
        <dropColumn tableName="content_file" columnName="question_id"/>
    </changeSet>

    <changeSet id="create_table_question_content_file" author="Darina">
        <createTable tableName="question_content_file">
            <column name="question_id" type="int"/>
            <column name="content_file_id" type="int"/>
        </createTable>
        <addForeignKeyConstraint baseTableName="question_content_file"
                                 baseColumnNames="question_id"
                                 constraintName="content_file_question_question_id_fk"
                                 referencedTableName="question"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="question_content_file"
                                 baseColumnNames="content_file_id"
                                 constraintName="content_file_question_content_id_fk"
                                 referencedTableName="content_file"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_error_report_table" author="Anlord241">
        <createTable tableName="error_report">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="report_body" type="clob">
            </column>
            <column name="question_id" type="int">
            </column>
            <column name="test_id" type="int">
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="error_report" baseColumnNames="question_id"
                                 constraintName="error_report_question_id_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="error_report" baseColumnNames="test_id"
                                 constraintName="error_report_test_id_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_user_avatar" author="maxim12321">
        <addColumn tableName="user">
            <column name="avatar" type="text"/>
        </addColumn>
    </changeSet>

    <changeSet id="update_user_avatars" author="maxim12321">
        <update tableName="user">
            <column name="avatar" value="https://www.meme-arsenal.com/memes/b13e5cd8fb1e4055a4da98828ec4434b.jpg"/>
            <where>user_login='rus_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://pbs.twimg.com/media/EFCCM6lW4AEIZnv.png"/>
            <where>user_login='rus_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://pbs.twimg.com/media/EFIiRRyXYAA_xGw.jpg"/>
            <where>user_login='rus_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar"
                    value="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZ8Mt5Mge2q4p3IYZjES9KK2pZLllTferBiw&amp;usqp=CAU"/>
            <where>user_login='rus_admin@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://www.meme-arsenal.com/memes/4dd8cb2342fb0b33903ef63ce932f17c.jpg"/>
            <where>user_login='eng_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar"
                    value="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSuuh5s5y7jYV94COE8sEz1IN9Uzv6cHP8W8Pw4EUD6WbCqhsr5jxas6WMXfzucwZ8ffYw&amp;usqp=CAU"/>
            <where>user_login='eng_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar"
                    value="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQCxgqz72g16sjgBVjvjtpGJqnMuUgIfutvlA&amp;usqp=CAU"/>
            <where>user_login='eng_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar"
                    value="http://risovach.ru/thumb/upload/200s400/2016/10/generator/mudryy-gus_127398097_orig_.jpg?32ndg"/>
            <where>user_login='eng_admin@northsixty.com'</where>
        </update>
    </changeSet>

    <changeSet id="rename_table" author="DzmitryNovik">
        <renameTable
                oldTableName="choosen_option"
                newTableName="chosen_option"/>
    </changeSet>

    <changeSet id="rename_column" author="DzmitryNovik">
        <renameColumn tableName="chosen_option"
                      oldColumnName="choosen_answer_id"
                      newColumnName="chosen_answer_id"
                      columnDataType="int"/>
    </changeSet>

    <changeSet id="add_field_testId_to_fileAnswer" author="DzmitryNovik">
        <addColumn tableName="file_answer">
            <column name="test_id" type="int"/>
        </addColumn>

        <addForeignKeyConstraint baseTableName="file_answer"
                                 baseColumnNames="test_id"
                                 constraintName="file_answer_test_id_fk"
                                 referencedTableName="test"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="delete_column_fileAnswerId_from_table_chosenOption" author="DzmitryNovik">
        <dropColumn tableName="chosen_option"
                    columnName="file_answer_id"/>
    </changeSet>

    <changeSet id="change_status_type_to_string" author="maxim12321">
        <modifyDataType tableName="test" columnName="status" newDataType="text"/>
    </changeSet>

    <changeSet id="update_statuses" author="maxim12321">
        <update tableName="test">
            <column name="status" value="ASSIGNED"/>
            <where>status='NOT_STARTED'</where>
        </update>
        <update tableName="test">
            <column name="status" value="COMPLETED"/>
            <where>status='FINISHED'</where>
        </update>
    </changeSet>

    <changeSet id="update_test_dates" author="maxim12321">
        <renameColumn tableName="test" oldColumnName="created_at" newColumnName="assigned_at"/>
        <renameColumn tableName="test" oldColumnName="updated_at" newColumnName="verified_at"/>
        <renameColumn tableName="test" oldColumnName="finished_at" newColumnName="completed_at"/>

        <addColumn tableName="test">
            <column name="deadline" type="datetime"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_not_null_constraints" author="maxim12321">
        <addNotNullConstraint tableName="answer" columnName="is_correct"/>
        <addNotNullConstraint tableName="answer" columnName="question_id"/>

        <addNotNullConstraint tableName="error_report" columnName="question_id"/>
        <addNotNullConstraint tableName="error_report" columnName="report_body"/>
        <addNotNullConstraint tableName="error_report" columnName="test_id"/>

        <addNotNullConstraint tableName="file_answer" columnName="test_id"/>

        <addNotNullConstraint tableName="question" columnName="creator_user_id"/>
        <addNotNullConstraint tableName="question" columnName="is_available"/>
        <addNotNullConstraint tableName="question" columnName="level_id"/>
        <addNotNullConstraint tableName="question" columnName="module_id"/>
        <addNotNullConstraint tableName="question" columnName="question_body"/>

        <addNotNullConstraint tableName="question_content_file" columnName="content_file_id"/>
        <addNotNullConstraint tableName="question_content_file" columnName="question_id"/>

        <addNotNullConstraint tableName="test" columnName="level_id"/>
        <addNotNullConstraint tableName="test" columnName="status"/>
        <addNotNullConstraint tableName="test" columnName="user_id"/>
    </changeSet>

    <changeSet id="add_module_grade_table" author="Anlord241">
        <createTable tableName="module_grade">
            <column name="grade" type="int">
            </column>
            <column name="module_id" type="int">
            </column>
            <column name="test_id" type="int">
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="module_grade" baseColumnNames="module_id"
                                 constraintName="module_grade_module_id_fk"
                                 referencedTableName="module" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="module_grade" baseColumnNames="test_id"
                                 constraintName="module_grade_test_id_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="remove_test_evaluation" author="Anlord241">
        <dropColumn tableName="test"
                    columnName="evaluation"/>
    </changeSet>

    <changeSet id="add_is_available" author="Darina">
        <addColumn tableName="content_file">
            <column name="is_available" type="boolean" defaultValue="true"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_topic" author="Darina">
        <addColumn tableName="content_file">
            <column name="topic" type="varchar(256)"/>
        </addColumn>
    </changeSet>

    <changeSet id="remove_id_from_file_answer" author="Darina">
        <dropColumn tableName="file_answer" columnName="id"/>
    </changeSet>

    <changeSet id="add_priority" author="Anlord241">
        <addColumn tableName="test">
            <column name="priority" type="text"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_default_priority" author="Anlord241">
        <addNotNullConstraint tableName="test"
                              columnName="priority"
                              defaultNullValue="LOW"/>
    </changeSet>

    <changeSet id="add_timer_table" author="Anlord241">
        <createTable tableName="timer">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="test_id" type="int">
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="timer" baseColumnNames="test_id"
                                 constraintName="timer_test_id_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_finish_time" author="Anlord241">
        <addColumn tableName="test">
            <column name="finish_time" type="datetime"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_coach_commentary" author="Anlord241">
        <addColumn tableName="coach_grade">
            <column name="comment" type="text"/>
        </addColumn>

        <addColumn tableName="module_grade">
            <column name="coach_comment" type="text"/>
        </addColumn>
    </changeSet>

    <changeSet id="add_notifications" author="maxim12321">
        <createTable tableName="notification">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="type" type="varchar(40)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="test_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="notification" baseColumnNames="user_id"
                                 constraintName="notification_user_id_fk"
                                 referencedTableName="user" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="notification" baseColumnNames="test_id"
                                 constraintName="notification_test_id_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="test_is_available" author="maxim12321">
        <addColumn tableName="test">
            <column name="is_available" type="boolean" defaultOnNull="true" defaultValue="true">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="module_grade_add_not_null" author="maxim12321">
        <addNotNullConstraint tableName="module_grade" columnName="test_id"/>
        <addNotNullConstraint tableName="module_grade" columnName="module_id"/>
    </changeSet>

    <changeSet id="add_composite_pk" author="maxim12321">
        <addPrimaryKey tableName="chosen_option" columnNames="test_id, question_id"/>

        <dropPrimaryKey tableName="coach_grade"/>
        <addPrimaryKey tableName="coach_grade" columnNames="test_id, question_id"/>
        <dropColumn tableName="coach_grade" columnName="id"/>

        <dropPrimaryKey tableName="error_report"/>
        <addPrimaryKey tableName="error_report" columnNames="test_id, question_id"/>
        <dropColumn tableName="error_report" columnName="id"/>

        <addPrimaryKey tableName="file_answer" columnNames="test_id, question_id"/>

        <addPrimaryKey tableName="module_grade" columnNames="test_id, module_id"/>

        <addPrimaryKey tableName="question_content_file" columnNames="question_id, content_file_id"/>

        <addPrimaryKey tableName="test_question" columnNames="test_id, question_id"/>
    </changeSet>

    <changeSet id="add_coach_answer_table" author="SemyonKorostik">
        <createTable tableName="coach_answer">
            <column name="question_id" type="int" >
                <constraints nullable="false"/>
            </column>
            <column name="test_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="comment" type="text"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="coach_answer" baseColumnNames="test_id"
                                 constraintName="coach_answer_test_id_fk"
                                 referencedTableName="test" referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="coach_answer" baseColumnNames="question_id"
                                 constraintName="coach_answer_question_id_fk"
                                 referencedTableName="question" referencedColumnNames="id"/>

    </changeSet>

    <changeSet id="add_primary_key_to_coach_answer_table" author="SemyonKorostik">
        <addPrimaryKey tableName="coach_answer" columnNames="test_id, question_id"/>
    </changeSet>

    <changeSet id="update_user_avatars_and_photos" author="Darina">
        <update tableName="user">
            <column name="avatar" value="https://bigpicture.ru/wp-content/uploads/2019/04/grandbeauty00.jpg"/>
            <column name="user_name" value="Katie Murphy"/>
            <where>user_login='rus_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://intrigue.dating/wp-content/uploads/2020/09/4346343-105.jpg"/>
            <column name="user_name" value="Michelle Phillips"/>
            <where>user_login='rus_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://pbs.twimg.com/profile_images/1101474856284155905/CNBTOxPX.png"/>
            <column name="user_name" value="Valerie Rivera"/>
            <where>user_login='rus_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://lh3.googleusercontent.com/proxy/uJ3PVXfB9ELPGcVDU1xXUwXEgcDwZWow_qnMg-ByuX2nGl2jPoCh1y92Y2YcDOc6bXRb_lFnq0_p37q52XT2Gu7fc9EwlN5qfF-qUttUbQBy"/>
            <column name="user_name" value="William Vega"/>
            <where>user_login='rus_admin@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://lifestylewomens.ru/wp-content/uploads/2021/05/14-jamie-dornan-2.jpg"/>
            <column name="user_name" value="Roger Bell"/>
            <where>user_login='eng_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://the-steppe.com/pictures/files/Alua%20Shymkent/WhatsApp%20Image%202019-09-06%20at%2010.37.49.jpeg"/>
            <column name="user_name" value="Vanessa Clark"/>
            <where>user_login='eng_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://www.womanhit.ru/media/CACHE/images/articleimage2/2019/2/2_jFpCK6q/c4d51a5a07fbfa5bd23d0d5c8052e3ee.png"/>
            <column name="user_name" value="Tom Fields"/>
            <where>user_login='eng_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://classpic.ru/wp-content/uploads/2016/02/14272/Kris-Hemsvort.jpg"/>
            <column name="user_name" value="James Berry"/>
            <where>user_login='eng_admin@northsixty.com'</where>
        </update>
    </changeSet>

    <changeSet id="update_admin_avatars" author="Darina">
        <update tableName="user">
            <column name="avatar" value="https://mykaleidoscope.ru/uploads/posts/2016-03/1459156672_modnyye-muzhskiye-pricheski-2-016-13.jpg"/>
            <where>user_login='rus_admin@northsixty.com'</where>
        </update>
    </changeSet>

    <changeSet id="fix_user_avatars" author="Darina">
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1I0auZ-BgW01jo1jT_d1Y-wsbdyFtuduq/view?usp=sharing"/>
            <column name="user_name" value="Katie Murphy"/>
            <where>user_login='rus_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1htDXVfe3KsTou6jbeIcDcFaG7XYu1uM-/view?usp=sharing"/>
            <column name="user_name" value="Michelle Phillips"/>
            <where>user_login='rus_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1G__uiV61ugOF01Ye80poD_ZGFVIQbcQi/view?usp=sharing"/>
            <column name="user_name" value="Valerie Rivera"/>
            <where>user_login='rus_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/10MRLmmDWAUItY-puqaHVjqAiOX9gYtbC/view?usp=sharing"/>
            <column name="user_name" value="William Vega"/>
            <where>user_login='rus_admin@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1s5Ivn3shDY-UDXmAUkoxedeiFGytDguB/view?usp=sharing"/>
            <column name="user_name" value="Roger Bell"/>
            <where>user_login='eng_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1suYX8sIxdnmBLEyYz3qKj4gR3qZ-NJPH/view?usp=sharing"/>
            <column name="user_name" value="Vanessa Clark"/>
            <where>user_login='eng_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1q4eN2Rv_yoxCGJEjTsZ_rWdYTeunmu0L/view?usp=sharing"/>
            <column name="user_name" value="Tom Fields"/>
            <where>user_login='eng_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://drive.google.com/file/d/1-Vne1qSwlRSztxtyiFYnCbDBE_-mUsY_/view?usp=sharing"/>
            <column name="user_name" value="James Berry"/>
            <where>user_login='eng_admin@northsixty.com'</where>
        </update>
    </changeSet>

    <changeSet id="fix_user_avatars_attempt_2" author="maxim12321">
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/rus_user.jpg"/>
            <where>user_login='rus_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/rus_hr.jpg"/>
            <where>user_login='rus_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/rus_coach.png"/>
            <where>user_login='rus_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/rus_admin.jpg"/>
            <where>user_login='rus_admin@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/eng_user.jpg"/>
            <where>user_login='eng_user@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/eng_hr.jpeg"/>
            <where>user_login='eng_hr@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/eng_coach.png"/>
            <where>user_login='eng_coach@northsixty.com'</where>
        </update>
        <update tableName="user">
            <column name="avatar" value="https://untitled-testing-system.herokuapp.com/resources/avatars/eng_admin.jpg"/>
            <where>user_login='eng_admin@northsixty.com'</where>
        </update>
    </changeSet>

    <changeSet id="add_timer_status" author="maxim12321">
        <addColumn tableName="timer">
            <column name="status" type="varchar(256)" defaultValue="STARTED">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="timer">
            <column name="scheduled_time" type="datetime">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

</databaseChangeLog>
